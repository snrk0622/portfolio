---
title: "【要約】リーダブルコード 表面上の改善"
date: "2024-01-10T00:00:00.000Z"
category: "blog"
tags:
  - '読書'
  - 'リーダブルコード'
---

# はじめに
初心に戻ってリーダブルコードを読んでみました。
https://www.oreilly.co.jp/books/9784873115658/

### 本記事のゴール
- [x] よいコード（読みやすいコード）を書けるようになる
- [x] レビューの質を上げる

この記事は自分のための備忘録的な目的がメインですが、皆さんの参考にもなれば幸いです。

-----

# I. 表面上の改善
## 2. 名前に情報を詰め込む
### 2.1 明確な単語を選ぶ
- 複数の意味に取れる単語は使わない
  - 例）`get`は取ってくる場所に合わせて`fetch`や`download`などにする

### 2.2 tmpやretValなどの汎用的な名前を避ける
- 基本的には汎用的な名前は使わず、エンティティの値や目的を表した名前を選ぶ
- 一次的な保管かつ生存期間がわずか数行の変数であれば、`tmp`なども利用可
- ループイテレータに`i`・`j`・`k`を利用するのは、イテレータであることを表せるので有効
  - イテレータが複数ある場合は、`members_i`や`users_i`のように接頭辞をつけるとベター

### 2.3 抽象的な名前よりも具体的な名前を使う
- 全ての機能を表す具体的な名前が思いつかない場合、機能を分割することを検討する

### 2.4 名前に条件を追加する
- 値の単位を名前に含める
  - 例）`start_time_ms`, `size_mb`
- その他の重要な属性を追加する
  - バグ（セキュリティに関するもの）になりそうなところだけでOK
    - 例）`unescaped_comment`, `plaintext_password`, `html_utf8`

### 2.5 名前の長さを決める
- 長い名前を避ける
  - 例）`newNavigationControllerWrappingViewControllerForDataSourceOfClass`
- スコープが小さければ短い名前でもいい
- 長い名前を入力するのは問題じゃない
  - テキストエディタには補完機能があるので、「入力しにくい」は長い名前を避ける理由にはならない
- 頭文字と省略形
  - プロジェクト固有の省略形は禁止
  - 一般的に広く使われる省略形はOK
    - 例）`string` -> `str`
- 不要な単語を投げ捨てる
  - 削除しても情報が**全く**損なわれない場合は削除OK
    - 例）`ConvertToString()` -> `ToString()`

### 2.6 名前のフォーマットで情報を伝える
- 大文字やアンダースコアなどに意味を含める
  - 例）
  - クラス名：CamelCase（キャメルケース）
  - 変数名：lower_separated（小文字をアンダースコアで区切ったもの）

## 3. 誤解されない名前
:::message
名前が「他の意味と間違えられることはないだろうか？」と何度も自問自答する
:::

### 3.1 例: filter()
- filterの結果、「選択する」のか「除外する」のか不明瞭
  - 「選択する」なら`select()`
  - 「除外する」なら`exclude()`

### 3.2 例: Clip(text, length)
```python:Bad Example
# textの最後を切り落として、「...」をつける
def Clip(text, length):
  ...
```

- 動作としてどちらを行うのか関数名からは不明瞭
  - 最後から`length`文字を削除する（`Remove`）
  - 最大`length`文字まで切り詰める（`Trancate`）←今回はこっち
- `length`という引数名も`max_length`にした方が明確
  - さらに長さは「文字数」を表していることがわかるように`max_chars`だとベター

### 3.3 限界値を含めるときはminとmaxを使う
```python:Bad Example
# ショッピングカードには商品が10点までしか入らない
CART_TOO_BIG_LIMIT = 10

if shopping_cart.num_itms() >= CART_TOO_BIG_LIMIT:
  Error("カートにある商品数が多すぎます。")
```
- `CART_TOO_BIG_LIMIT`
  - 条件にこの値を含めるべきか（「未満」か「以下」か）わからない
  - 結果、上記コードでは「off-by-oneエラー[^1]」のバグが発生している
  - `MAX_ITEMS_IN_CART`ならその値を含めるべきことが明確

[^1]: 境界条件の判定に関するエラー

### 3.4 範囲を指定するときはfirstとlastを使う
```python:Bad Example
print integer_range(start=2, stop=4)
```
- `stop`
  - 範囲の対象なのか、非対象なのかわからない
  - `last`を使えば対象であることが明確

### 3.5 包含/排他的範囲にはbeginとendを使う
:::details 包含/排他的な範囲とは
例）10/16に開催されたイベントを全て出力したい
```python:Bad Example
PrintEventsInRange("OCT 16 12:00am", "OCT 16 11:59:59.999pm")
```
↓ 包含/排他的範囲を使うと簡潔に書ける
```python
# 第２引数の時刻は「含まない」→ 排他的
PrintEventsInRange("OCT 16 12:00am", "OCT 17 12:00am")
```
:::
- 包含/排他的範囲には`begin`と`end`を使うことが多い
  - `end`は曖昧な気もするが、英語に「ちょうど最後の値を超えたところ」を意味する単語がない・・・
  - ただプログラミングでは排他的範囲の終端をendと表すことが慣習となっている

### 3.6 ブール値の名前
```python:Bad Example
bool read_password = true
```
- パスワードを「**これから**読み取る必要がある」のか「**すでに**読み取っている」のか不明瞭
  - ブール値の変数名には`is`・`has`・`can`・`should`などをつけることが多い


```python:Bad Example
bool disable_ssl = true
```
- 名前を否定系にするのも理解を難しくするので避ける
  - 上記の例だと値としてはtrueだが、sslは無効を表す
  - 変数の値と表す状態が**逆**になっている

### 3.7 ユーザの期待に合わせる
:::message
別の意味で使っていても、ユーザの先入観で誤解されてしまうケースがある
その場合、「負けを認めて」誤解されない名前に変えた方がいい
:::

- 例: get*()
  - `get`で始まるメソッドはメンバの値を返すだけの「軽量アクセッサ」であるという規約に慣れ親しんでいる
  - 「負けを認めて」`get`を他の単語に変えた方がいい

### 3.8 例: 複数の名前を検討する
- **他の人**がどう誤解する可能性があるかを検討の軸にする
- その単語だけでは誤解を招く可能性がある場合は、補足の単語を追加する
  - 例）`inherit_from`という名前は何かを継承することはわかるが、実際何を値として与えれば良いか不明瞭
  - `inherit_from_experiment_id`とすれば、継承したい`experiment_id`を与えれば良いとわかる

## 4. 美しさ
:::message
優れたソースコードは「目に優しい」
:::

#### 3つの原則
- 読み手が慣れているパターンと一貫性のあるレイアウトを使う
- 似ているコードは似ているように見せる
- 関連するコードをまとめてブロックにする

### 4.1 なぜ美しさが大切なのか？
- プログラミングの時間のほとんどはコードを読む時間

### 4.2 一貫性のある簡潔な改行位置
- 内容が似ているコードでも「シルエット」が異なるとそればかり目立ってしまう

### 4.3 メソッドを使った整列
- 何度も同じ処理が出てきたらメソッドにする
  - 「面倒な仕事」が全てメソッドに隠蔽される
  - = 読みやすくなる

### 4.4 縦の線をまっすぐにする
```Java:Good Example
CheckFullName("Doug Adams"  , "Mr. Douglas Adams" , "");
CheckFullName(" Jake Brown ", "Mr. Jake Brown III", "");
CheckFullName("No Such Guy" , ""                  , "no match found");
CheckFullName("John"        , ""                  , "more then one result");
```
- メリット
  - 関係性を理解しやすい
- デメリット
  - 手間がかかる
  - 1行だけ変更したいのに、他の行も変更しなければならない（差分が増える）

### 4.5 一貫性と意味のある並び
- 本来順番に意味のない複数のコードは、意味のある順番に並べるといい
- どんな並び順でも良いが、一連のコード内では同じ並び順を使うべき
  - 例）対応するHTMLフォームの`<input>`フィールドと同じ並び順にする
  - 例）「最重要」なものから重要度順に並べる
  - 例）アルファベット順に並べる

### 4.6 宣言をブロックにまとめる
- 複数の宣言文を役割ごとにブロックにする（空白行を間に入れる）
  - 例）役割
    - ハンドラ
    - リクエストとリプライのユーティリティ
    - データベースのヘルパー